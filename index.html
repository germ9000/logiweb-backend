<!DOCTYPE html>
<html class="light" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Dashboard - Logística Web</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Theme Configuration -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-light": "#ffffff",
                        "surface-dark": "#1a2632",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#111418] dark:text-white transition-colors duration-200">
    <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Top Navigation Bar -->
        <header class="sticky top-0 z-50 flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark px-10 py-3 shadow-sm">
            <div class="flex items-center gap-4 text-[#111418] dark:text-white">
                <div class="flex items-center justify-center size-10 rounded-lg bg-primary/10 text-primary">
                    <span class="material-symbols-outlined text-3xl">inventory_2</span>
                </div>
                <h2 class="text-lg font-bold leading-tight tracking-[-0.015em]">Logística Web</h2>
            </div>
            
            <div class="flex flex-1 justify-end gap-8">
                <!-- Navigation Links -->
                <nav class="hidden lg:flex items-center gap-9">
                    <a class="text-primary text-sm font-bold leading-normal relative after:content-[''] after:absolute after:-bottom-5 after:left-0 after:w-full after:h-0.5 after:bg-primary" href="index.html">Dashboard</a>
                    <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium leading-normal transition-colors" href="pages/estoque.html">Estoque</a>
                    <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium leading-normal transition-colors" href="pages/entradas.html">Entradas</a>
                    <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium leading-normal transition-colors" href="pages/saidas.html">Saídas</a>
                    <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium leading-normal transition-colors" href="pages/historico.html">Histórico</a>
                    <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary text-sm font-medium leading-normal transition-colors" href="pages/usuarios.html">Usuários</a>
                </nav>
                
                <!-- User Profile -->
                <div class="flex items-center gap-4">
                    <button class="flex items-center gap-2" onclick="toggleTheme()">
                        <span class="material-symbols-outlined text-gray-600 dark:text-gray-300 hover:text-primary">brightness_4</span>
                    </button>
                    <button class="flex items-center gap-2">
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-9 border-2 border-white dark:border-gray-700 shadow-sm" style='background-image: url("https://ui-avatars.com/api/?name=Admin&background=137fec&color=fff");'></div>
                        <span class="material-symbols-outlined text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">expand_more</span>
                    </button>
                </div>
            </div>
        </header>
 
        <!-- Main Content -->
        <main class="flex-1 flex flex-col items-center py-8 px-4 sm:px-10 lg:px-20">
            <div class="w-full max-w-7xl flex flex-col gap-6">
                <!-- Breadcrumbs & Heading -->
                <div class="flex flex-col gap-2">
                    <div class="flex flex-wrap gap-2 items-center text-sm">
                        <span class="text-[#111418] dark:text-white font-medium">Dashboard</span>
                    </div>
                    <h1 class="text-4xl font-bold leading-tight tracking-[-0.015em]">Bem-vindo ao Logística Web</h1>
                    <p class="text-gray-600 dark:text-gray-300 text-base">Gerencie seu estoque com eficiência e precisão</p>
                </div>
 
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- Total Items -->
                    <div class="stat-card flex flex-col gap-3 rounded-2xl border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-6">
                        <div class="flex items-center justify-between">
                            <div class="flex flex-col gap-1">
                                <p class="text-gray-600 dark:text-gray-400 text-sm font-medium">Total de Itens</p>
                                <p class="text-3xl font-bold" id="totalItems">-</p>
                            </div>
                            <div class="flex items-center justify-center size-12 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600">
                                <span class="material-symbols-outlined">inventory_2</span>
                            </div>
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs">Produtos cadastrados</p>
                    </div>
 
                    <!-- Low Stock -->
                    <div class="stat-card flex flex-col gap-3 rounded-2xl border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-6">
                        <div class="flex items-center justify-between">
                            <div class="flex flex-col gap-1">
                                <p class="text-gray-600 dark:text-gray-400 text-sm font-medium">Estoque Baixo</p>
                                <p class="text-3xl font-bold" id="lowStock">-</p>
                            </div>
                            <div class="flex items-center justify-center size-12 rounded-lg bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600">
                                <span class="material-symbols-outlined">warning</span>
                            </div>
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs">Itens com quantidade baixa</p>
                    </div>
 
                    <!-- Today Movements -->
                    <div class="stat-card flex flex-col gap-3 rounded-2xl border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-6">
                        <div class="flex items-center justify-between">
                            <div class="flex flex-col gap-1">
                                <p class="text-gray-600 dark:text-gray-400 text-sm font-medium">Movimentações Hoje</p>
                                <p class="text-3xl font-bold" id="todayMovements">-</p>
                            </div>
                            <div class="flex items-center justify-center size-12 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-600">
                                <span class="material-symbols-outlined">trending_up</span>
                            </div>
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs">Entradas e saídas</p>
                    </div>
 
                    <!-- Active Users -->
                    <div class="stat-card flex flex-col gap-3 rounded-2xl border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-6">
                        <div class="flex items-center justify-between">
                            <div class="flex flex-col gap-1">
                                <p class="text-gray-600 dark:text-gray-400 text-sm font-medium">Usuários Ativos</p>
                                <p class="text-3xl font-bold" id="activeUsers">-</p>
                            </div>
                            <div class="flex items-center justify-center size-12 rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-600">
                                <span class="material-symbols-outlined">people</span>
                            </div>
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs">Usuários do sistema</p>
                    </div>
                </div>
 
                <!-- Quick Actions -->
                <div class="flex flex-col gap-4">
                    <h3 class="text-lg font-bold">Ações Rápidas</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <a href="pages/entradas.html" class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-primary text-2xl">add_circle</span>
                            <div>
                                <p class="font-medium">Nova Entrada</p>
                                <p class="text-xs text-gray-500">Adicionar itens</p>
                            </div>
                        </a>
                        
                        <a href="pages/saidas.html" class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-primary text-2xl">remove_circle</span>
                            <div>
                                <p class="font-medium">Nova Saída</p>
                                <p class="text-xs text-gray-500">Remover itens</p>
                            </div>
                        </a>
                        
                        <a href="pages/estoque.html" class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-primary text-2xl">inventory</span>
                            <div>
                                <p class="font-medium">Ver Estoque</p>
                                <p class="text-xs text-gray-500">Consultar disponibilidade</p>
                            </div>
                        </a>
                        
                        <a href="pages/historico.html" class="flex items-center gap-3 rounded-lg border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                            <span class="material-symbols-outlined text-primary text-2xl">history</span>
                            <div>
                                <p class="font-medium">Histórico</p>
                                <p class="text-xs text-gray-500">Ver movimentações</p>
                            </div>
                        </a>
                    </div>
                </div>
 
                <!-- Recent Movements -->
                <div class="flex flex-col gap-4">
                    <h3 class="text-lg font-bold">Movimentações Recentes</h3>
                    <div class="rounded-lg border border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark overflow-hidden">
                        <div class="overflow-x-auto custom-scrollbar">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-800">
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">ID</th>
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Produto</th>
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Tipo</th>
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Quantidade</th>
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Data/Hora</th>
                                        <th class="text-left px-6 py-3 text-sm font-semibold text-gray-600 dark:text-gray-400">Usuário</th>
                                    </tr>
                                </thead>
                                <tbody id="recentMovementsTable">
                                    <tr>
                                        <td colspan="6" class="text-center px-6 py-8 text-gray-500">Carregando...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
 
    <!-- Scripts -->
    <script src="logiweb-config.js"></script>
    <script src="logiweb-api.js"></script>
    <script>
        // Inicializar API
        let api = null;
 
        async function initDashboard() {
            try {
                // Validar configuração
                if (!validateConfig()) {
                    alert('⚠️ Erro: Chave API do Google Sheets não configurada!
 
Edite o arquivo logiweb-config.js e adicione sua chave API.');
                    return;
                }
 
                // Inicializar API
                api = initializeAPI(CONFIG);
 
                // Carregar dados
                await loadDashboardData();
            } catch (error) {
                console.error('Erro ao inicializar dashboard:', error);
                alert('Erro ao carregar dados. Verifique a configuração e tente novamente.');
            }
        }
 
        async function loadDashboardData() {
            try {
                // Carregar itens
                const items = await api.getItems();
                document.getElementById('totalItems').textContent = items.length;
 
                // Contar itens com estoque baixo
                const lowStockCount = items.filter(item => {
                    const qty = parseInt(item['Quantidade'] || item['quantidade'] || 0);
                    return qty < 10; // Considerar baixo estoque < 10
                }).length;
                document.getElementById('lowStock').textContent = lowStockCount;
 
                // Carregar movimentações
                const movements = await api.getMovements();
                
                // Contar movimentações de hoje
                const today = new Date().toDateString();
                const todayMovements = movements.filter(mov => {
                    const movDate = new Date(mov['Data'] || mov['data']).toDateString();
                    return movDate === today;
                }).length;
                document.getElementById('todayMovements').textContent = todayMovements;
 
                // Carregar usuários
                const users = await api.getUsers();
                document.getElementById('activeUsers').textContent = users.length;
 
                // Carregar movimentações recentes
                loadRecentMovements(movements.slice(0, 5));
            } catch (error) {
                console.error('Erro ao carregar dados do dashboard:', error);
            }
        }
 
        function loadRecentMovements(movements) {
            const tbody = document.getElementById('recentMovementsTable');
            
            if (movements.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center px-6 py-8 text-gray-500">Nenhuma movimentação encontrada</td></tr>';
                return;
            }
 
            tbody.innerHTML = movements.map(mov => `
                <tr class="border-b border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50">
                    <td class="px-6 py-3 text-sm">${mov['ID Movimentação'] || mov['id'] || '-'}</td>
                    <td class="px-6 py-3 text-sm">${mov['Produto'] || mov['produto'] || '-'}</td>
                    <td class="px-6 py-3 text-sm">
                        <span class="inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${
                            (mov['Tipo'] || mov['tipo'] || '').toLowerCase().includes('entrada') 
                                ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300' 
                                : 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-300'
                        }">
                            ${mov['Tipo'] || mov['tipo'] || '-'}
                        </span>
                    </td>
                    <td class="px-6 py-3 text-sm">${mov['Quantidade'] || mov['quantidade'] || '-'}</td>
                    <td class="px-6 py-3 text-sm text-gray-500">${mov['Data / Hora'] || mov['data'] || '-'}</td>
                    <td class="px-6 py-3 text-sm">${mov['Usuário'] || mov['usuario'] || '-'}</td>
                </tr>
            `).join('');
        }
 
        function toggleTheme() {
            const html = document.documentElement;
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
        }
 
        // Restaurar tema salvo
        function restoreTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            }
        }
 
        // Inicializar ao carregar a página
        restoreTheme();
        initDashboard();
    </script>
</body>
</html>
