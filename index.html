<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema LogiWeb</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .card { border: 1px solid #ccc; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input, select { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background-color: #0070f3; color: white; border: none; padding: 10px 20px; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #0051a2; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .hidden { display: none; }
        .error { color: red; }
    </style>
</head>
<body>

    <h1>ðŸ“¦ LogiWeb System</h1>

    <div id="login-screen" class="card">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Seu e-mail">
        <input type="password" id="senha" placeholder="Sua senha">
        <button onclick="fazerLogin()">Entrar</button>
        <p id="login-msg" class="error"></p>
    </div>

    <div id="dashboard" class="hidden">
        <p>Bem-vindo, <strong id="user-name">UsuÃ¡rio</strong>! <button onclick="sair()" style="background:#555; padding:5px 10px;">Sair</button></p>
        
        <div class="card">
            <h3>âž• Novo Item</h3>
            <input type="text" id="novo-id" placeholder="ID (Ex: 001)">
            <input type="text" id="novo-nome" placeholder="Nome do Produto">
            <input type="text" id="novo-cat" placeholder="Categoria">
            <input type="number" id="novo-qtd" placeholder="Quantidade">
            <button onclick="adicionarItem()">Salvar na Planilha</button>
        </div>

        <div class="card">
            <h3>ðŸ“‹ InventÃ¡rio Atual</h3>
            <button onclick="carregarItens()">ðŸ”„ Atualizar Lista</button>
            <table id="tabela-itens">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Categ.</th>
                        <th>Qtd</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // FUNÃ‡ÃƒO DE LOGIN
        async function fazerLogin() {
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const msg = document.getElementById('login-msg');

            msg.innerText = "Carregando...";

            try {
                const res = await fetch('/api/auth-login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, senha })
                });

                const data = await res.json();

                if (res.ok) {
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('user-name').innerText = data.nome;
                    carregarItens(); // JÃ¡ carrega a lista ao entrar
                } else {
                    msg.innerText = data.error || "Erro ao entrar";
                }
            } catch (error) {
                msg.innerText = "Erro de conexÃ£o.";
            }
        }

        // FUNÃ‡ÃƒO CARREGAR ITENS (GET)
        async function carregarItens() {
            const tbody = document.querySelector('#tabela-itens tbody');
            tbody.innerHTML = '<tr><td colspan="4">Carregando...</td></tr>';

            const res = await fetch('/api/items');
            const lista = await res.json();

            tbody.innerHTML = ''; // Limpa
            
            lista.forEach(item => {
                // item Ã© um array [id, nome, categoria, qtd, ...]
                const row = `<tr>
                    <td>${item[0]}</td>
                    <td>${item[1]}</td>
                    <td>${item[2]}</td>
                    <td>${item[3]}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        // FUNÃ‡ÃƒO ADICIONAR ITEM (POST)
        async function adicionarItem() {
            const body = {
                id: document.getElementById('novo-id').value,
                nome: document.getElementById('novo-nome').value,
                categoria: document.getElementById('novo-cat').value,
                quantidade: document.getElementById('novo-qtd').value,
                local: "DepÃ³sito A", // PadrÃ£o
                status: "OK",
                previsao: "N/A"
            };

            await fetch('/api/items', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            alert("Item salvo!");
            carregarItens(); // Recarrega a lista
            
            // Limpar campos
            document.getElementById('novo-nome').value = "";
        }

        function sair() {
            location.reload();
        }
    </script>
</body>
</html>
